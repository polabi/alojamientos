openapi: 3.0.3
info:
  title: API Proyecto Final - Placey
  description: API de gestión de usuarios, alojamientos, reservas, comentarios y favoritos.
  version: "1.0.0"
servers:
  - url: http://localhost:8080
    description: Servidor local

tags:
  - name: Users
  - name: Auth
  - name: Me
  - name: Accommodations
  - name: Bookings
  - name: Comments
  - name: Favorites

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    CreateUserRequest:
      type: object
      required: [name, email, password, phoneNumber, role, dateBirth]
      properties:
        name: { type: string, example: "carlos" }
        email: { type: string, example: "carlos@email.com" }
        password: { type: string, example: "123" }
        phoneNumber: { type: string, example: "12345" }
        role: { type: string, enum: [USER, ADMIN, HOST], example: "USER" }
        dateBirth: { type: string, format: date, example: "1900-10-10" }

    EditUserRequest:
      type: object
      properties:
        name: { type: string, example: "carlos" }
        phoneNumber: { type: string, example: "12345" }
        profilePhoto: { type: string, example: "url de la foto" }

    ChangePasswordRequest:
      type: object
      properties:
        password: { type: string, example: "Nueva123" }

    LoginRequest:
      type: object
      properties:
        email: { type: string, example: "carlos@email.com" }
        password: { type: string, example: "123" }

    RefreshRequest:
      type: object
      properties:
        refreshToken: { type: string, example: "dGhpc2lzcnRrZW4=" }

    ForgotPasswordRequest:
      type: object
      properties:
        email: { type: string, example: "carlos@email.com" }

    ResetPasswordRequest:
      type: object
      properties:
        email: { type: string, example: "carlos@email.com" }
        code: { type: string, example: "123456" }
        newPassword: { type: string, example: "Nueva123" }

    HostProfileRequest:
      type: object
      properties:
        about: { type: string, example: "Anfitrión desde 2020" }
        legalDocs:
          type: array
          items: { type: string }
          example: ["doc.pdf"]
        photoIdUrl: { type: string, example: "https://example.com/id.jpg" }

    CreateAccommodationRequest:
      type: object
      required: [title, description, city, address, pricePerNight, capacity, services]
      properties:
        title: { type: string, example: "Apartamento en el centro" }
        description: { type: string, example: "Cómodo apartamento cerca del parque" }
        city: { type: string, example: "Bogotá" }
        address: { type: string, example: "Cra 10 #20-30" }
        pricePerNight: { type: number, example: 150000 }
        capacity: { type: integer, example: 4 }
        photos:
          type: array
          items: { type: string }
          example: ["foto1.jpg", "foto2.jpg"]
        services:
          type: array
          items: { type: string }
          example: ["wifi", "television"]

    EditAccommodationRequest:
      type: object
      properties:
        title: { type: string, example: "Apartamento remodelado" }
        description: { type: string, example: "Con nuevos acabados" }
        city: { type: string, example: "Medellín" }
        address: { type: string, example: "Calle 45 #10-50" }
        pricePerNight: { type: number, example: 180000 }
        capacity: { type: integer, example: 5 }
        photos:
          type: array
          items: { type: string }
        services:
          type: array
          items: { type: string }

    CreateBookingRequest:
      type: object
      required: [from, to, guests]
      properties:
        from: { type: string, format: date, example: "2025-09-10" }
        to: { type: string, format: date, example: "2025-09-15" }
        guests: { type: integer, example: 2 }
        message: { type: string, example: "Viaje de aniversario" }

    CommentRequest:
      type: object
      required: [rating, text]
      properties:
        rating: { type: integer, minimum: 1, maximum: 5, example: 4 }
        text: { type: string, example: "Muy buen alojamiento, todo limpio y ordenado" }

    ReplyRequest:
      type: object
      required: [text]
      properties:
        text: { type: string, example: "Gracias por tu comentario, bienvenido siempre." }

paths:
  /users:
    post:
      tags: [Users]
      summary: Registro de usuarios
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateUserRequest'
      responses:
        "201": { description: Usuario creado }
        "400": { description: Datos faltantes }
        "409": { description: Correo repetido }

  /users/{id}:
    get:
      tags: [Users]
      summary: Obtener usuario por ID
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      security: [ { bearerAuth: [] } ]
      responses:
        "200": { description: Datos del usuario }
        "401": { description: No autenticado }
        "403": { description: Sin permisos }
        "404": { description: No encontrado }
    put:
      tags: [Users]
      summary: Editar perfil del usuario
      security: [ { bearerAuth: [] } ]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EditUserRequest'
      responses:
        "200": { description: Usuario actualizado }
        "400": { description: Datos faltantes }
        "401": { description: No autenticado }
        "403": { description: Sin permisos }
        "404": { description: No encontrado }
    delete:
      tags: [Users]
      summary: Eliminar usuario
      security: [ { bearerAuth: [] } ]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "200": { description: Usuario eliminado }
        "401": { description: No autenticado }
        "403": { description: Sin permisos }
        "404": { description: No encontrado }
    patch:
      tags: [Users]
      summary: Cambiar contraseña
      security: [ { bearerAuth: [] } ]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChangePasswordRequest'
      responses:
        "200": { description: Contraseña cambiada }
        "401": { description: No autenticado }
        "403": { description: Sin permisos }
        "404": { description: No encontrado }

  /users/login:
    post:
      tags: [Auth]
      summary: Iniciar sesión
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        "200": { description: Inicio exitoso }
        "401": { description: Credenciales inválidas }

  /auth/refresh:
    post:
      tags: [Auth]
      summary: Refrescar token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RefreshRequest'
      responses:
        "200": { description: Nuevo token generado }
        "401": { description: Token inválido }

  /auth/logout:
    post:
      tags: [Auth]
      summary: Cerrar sesión
      security: [ { bearerAuth: [] } ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RefreshRequest'
      responses:
        "204": { description: Sesión cerrada }
        "401": { description: Token inválido }

  /auth/reset-password/request:
    post:
      tags: [Auth]
      summary: Solicitar restablecimiento de contraseña
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ForgotPasswordRequest'
      responses:
        "204": { description: Código enviado }
        "404": { description: Usuario no existe }

  /auth/reset-password/confirm:
    post:
      tags: [Auth]
      summary: Confirmar restablecimiento de contraseña
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ResetPasswordRequest'
      responses:
        "204": { description: Contraseña actualizada }
        "400": { description: Código inválido o expirado }

  /me:
    get:
      tags: [Me]
      summary: Ver mi perfil
      security: [ { bearerAuth: [] } ]
      responses:
        "200": { description: Datos del usuario autenticado }
        "401": { description: No autenticado }
    put:
      tags: [Me]
      summary: Editar mi perfil
      security: [ { bearerAuth: [] } ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EditUserRequest'
      responses:
        "200": { description: Usuario actualizado }
        "400": { description: Datos inválidos }
        "401": { description: No autenticado }

  /me/host-profile:
    put:
      tags: [Me]
      summary: Completar perfil anfitrión
      security: [ { bearerAuth: [] } ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/HostProfileRequest'
      responses:
        "200": { description: Perfil anfitrión actualizado }
        "401": { description: No autenticado }

  /me/accommodations:
    get:
      tags: [Me]
      summary: Mis alojamientos
      security: [ { bearerAuth: [] } ]
      parameters:
        - in: query
          name: page
          schema: { type: integer }
        - in: query
          name: size
          schema: { type: integer }
      responses:
        "200": { description: Lista de alojamientos }
        "401": { description: No autenticado }

  /accommodations:
    post:
      tags: [Accommodations]
      summary: Crear alojamiento
      security: [ { bearerAuth: [] } ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateAccommodationRequest'
      responses:
        "201": { description: Alojamiento creado }
        "400": { description: Datos inválidos }
        "401": { description: No autenticado }

  /accommodations/{id}:
    get:
      tags: [Accommodations]
      summary: Ver detalle de un alojamiento
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "200": { description: Datos completos del alojamiento }
        "404": { description: No encontrado }
    put:
      tags: [Accommodations]
      summary: Editar alojamiento
      security: [ { bearerAuth: [] } ]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EditAccommodationRequest'
      responses:
        "200": { description: Alojamiento actualizado }
        "401": { description: No autenticado }
        "403": { description: Sin permisos }
        "404": { description: No encontrado }
    delete:
      tags: [Accommodations]
      summary: Eliminar alojamiento
      security: [ { bearerAuth: [] } ]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "204": { description: Marcado como eliminado }
        "409": { description: Tiene reservas futuras }
        "401": { description: No autenticado }
        "403": { description: Sin permisos }

  /accommodations/search:
    get:
      tags: [Accommodations]
      summary: Buscar alojamientos
      parameters:
        - in: query
          name: city
          schema: { type: string }
        - in: query
          name: from
          schema: { type: string, format: date }
        - in: query
          name: to
          schema: { type: string, format: date }
        - in: query
          name: guests
          schema: { type: integer }
        - in: query
          name: priceMin
          schema: { type: number }
        - in: query
          name: priceMax
          schema: { type: number }
        - in: query
          name: services
          schema:
            type: array
            items: { type: string }
        - in: query
          name: page
          schema: { type: integer }
        - in: query
          name: size
          schema: { type: integer }
      responses:
        "200": { description: Lista de alojamientos }

  /accommodations/{id}/availability:
    get:
      tags: [Accommodations]
      summary: Disponibilidad por mes
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
        - in: query
          name: month
          required: true
          schema: { type: string, example: "2025-09" }
      responses:
        "200": { description: Fechas ocupadas/libres }
        "404": { description: No encontrado }

  /accommodations/{id}/bookings:
    post:
      tags: [Bookings]
      summary: Crear reserva
      security: [ { bearerAuth: [] } ]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateBookingRequest'
      responses:
        "201": { description: Reserva creada }
        "400": { description: Fechas inválidas }
        "409": { description: Capacidad excedida }

  /bookings:
    get:
      tags: [Bookings]
      summary: Mis reservas
      security: [ { bearerAuth: [] } ]
      parameters:
        - in: query
          name: page
          schema: { type: integer }
        - in: query
          name: size
          schema: { type: integer }
        - in: query
          name: status
          schema: { type: string }
        - in: query
          name: from
          schema: { type: string, format: date }
        - in: query
          name: to
          schema: { type: string, format: date }
      responses:
        "200": { description: Lista de reservas }
        "401": { description: No autenticado }

  /bookings/{id}:
    get:
      tags: [Bookings]
      summary: Ver una reserva
      security: [ { bearerAuth: [] } ]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "200": { description: Datos de la reserva }
        "401": { description: No autenticado }
        "404": { description: No encontrado }

  /bookings/{id}/cancel:
    patch:
      tags: [Bookings]
      summary: Cancelar reserva
      security: [ { bearerAuth: [] } ]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "204": { description: Cancelada }
        "409": { description: Ventana vencida }
        "401": { description: No autenticado }

  /bookings/{id}/approve:
    patch:
      tags: [Bookings]
      summary: Aprobar reserva
      security: [ { bearerAuth: [] } ]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "204": { description: Aprobada }
        "409": { description: Conflict }
        "401": { description: No autenticado }

  /bookings/{id}/reject:
    patch:
      tags: [Bookings]
      summary: Rechazar reserva
      security: [ { bearerAuth: [] } ]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ReplyRequest'
      responses:
        "204": { description: Rechazada }
        "409": { description: Conflict }
        "401": { description: No autenticado }

  /bookings/{id}/complete:
    patch:
      tags: [Bookings]
      summary: Completar reserva
      security: [ { bearerAuth: [] } ]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "204": { description: Completada }
        "401": { description: No autenticado }

  /bookings/{id}/comments:
    post:
      tags: [Comments]
      summary: Crear comentario
      security: [ { bearerAuth: [] } ]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CommentRequest'
      responses:
        "201": { description: Comentario creado }
        "400": { description: Datos inválidos }
        "401": { description: No autenticado }

  /comments/{commentId}/reply:
    post:
      tags: [Comments]
      summary: Responder comentario
      security: [ { bearerAuth: [] } ]
      parameters:
        - in: path
          name: commentId
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ReplyRequest'
      responses:
        "201": { description: Respuesta creada }
        "401": { description: No autenticado }

  /me/favorites:
    get:
      tags: [Favorites]
      summary: Ver mis favoritos
      security: [ { bearerAuth: [] } ]
      responses:
        "200": { description: Lista de favoritos }
        "401": { description: No autenticado }

  /me/favorites/{id}:
    post:
      tags: [Favorites]
      summary: Añadir a favoritos
      security: [ { bearerAuth: [] } ]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "201": { description: Añadido a favoritos }
        "401": { description: No autenticado }
    delete:
      tags: [Favorites]
      summary: Eliminar de favoritos
      security: [ { bearerAuth: [] } ]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "204": { description: Eliminado de favoritos }
        "401": { description: No autenticado }